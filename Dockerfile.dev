# Development Dockerfile with Vite HMR
FROM node:18-alpine

# Set working directory
WORKDIR /app

# Install dependencies for better file watching in Docker
RUN apk add --no-cache inotify-tools

# Copy package files first for better Docker layer caching
COPY deepiri-web-frontend/package*.json ./

# Install dependencies
RUN npm install --legacy-peer-deps

# Copy source code (this will be overridden by volume mount)
COPY deepiri-web-frontend/ .

# Copy K8s env loader scripts
COPY --chown=root:root ops/k8s/load-k8s-env.sh /usr/local/bin/load-k8s-env.sh
COPY --chown=root:root ops/k8s/docker-entrypoint.sh /usr/local/bin/docker-entrypoint.sh
RUN chmod +x /usr/local/bin/load-k8s-env.sh /usr/local/bin/docker-entrypoint.sh

# Expose Vite dev server port
EXPOSE 5173

# Set environment for development
ENV NODE_ENV=development

# Start Vite development server with HMR (with K8s env loading)
ENTRYPOINT ["/usr/local/bin/docker-entrypoint.sh"]
CMD ["npm", "run", "dev:turbo"]
